---
layout: post
title: " Working with Python in R"
subtitle: python + Rstudio
#output: rmarkdown::github_document

output:
  html_document:
    keep_md: true    
    toc: true
    toc_float: TRUE
    theme: united
author: Nana Boateng
df_print: paged
Time: '`r Sys.time()`'
date: "`r format(Sys.time(), '%B %d, %Y')`"
toc_depth: 3  # upto three depths of headings (specified by #, ## and ###)
number_sections: true  ## if you want number sections at each table header
highlight: tango  # specifies the syntax highlighting style
tags:  python,reticulate,rstudio
---


Introduction
---------------------------------
Python and R are the most popular machine learning languages. Jupiter notebooks are the most popular platform for python users to write up and run code. Rmarkdown can also be used for this same purpose. The choice of which of these two largely depends on your goals, interest  and background.Those with a background in statistics overwhemly prefer to work in R wheareas those with computer science background prefer python. Which is better? R or Python is often asked.  Neither one is beter than the other. A third alternative I believe is using both together. The availability of libraries that allows you to work interchangeably between the two languages has made data science officialy agnostic. Examples of these packages include  rPython, PythonInR, reticulate , rJython, SnakeCharmR and XRPython.  


```{r setup,include=FALSE}
library(knitr)

library(reticulate)

knitr::knit_engines$set(python = reticulate::eng_python)

knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      out.width ="100%",
                      message = FALSE,
                      fig.align = 'default', 
                      warning = FALSE, 
                      fig.cap ="Fig. 30", 
                      out.width="100%")

options(repr.plot.height = 7, repr.plot.width = 7)
options(tidyverse.quiet = TRUE)
options(dplyr.print_max = 1e9)

```

#### Load the required packages.

```{r}
pacman::p_load(skimr,kableExtra,tidyverse,reticulate,scales,viridis)
```



The  Python Engine
---------------------------------------------------

This is a  new Python language engine for R Markdown. It  supports bi-directional communication between R and Python (R chunks can access Python objects and vice-versa).

```{r engine='python'}
import csv
import datetime
import re
import codecs
import requests
import pandas as pd
import random as r

# Importing Dataset

data = pd.read_csv("https://raw.githubusercontent.com/NanaAkwasiAbayieBoateng/Datasets/master/EmployeeAttrition.csv")


# Print Text
print( "working with python" +"in R is much fun")

#generate a random number

import random as r

print(r.random())

print(data[['Age','Attrition','BusinessTravel','DailyRate','Department']].head(3))



```



```{r engine='python', highlight=TRUE}

# summary statistics from the data
print(data.describe())


#get the current working directory
import os
cwd = os.getcwd()

print(cwd)

print("Path at terminal when executing this file")
print(os.getcwd() + "\n")





```





```{r engine='python' , highlight=TRUE}


#matplotlib inline
#Import datavis libraries
import matplotlib.pyplot as plt
# Hide warnings if there are any
import warnings
warnings.filterwarnings('ignore')
import pandas_datareader.data as web
import numpy as np
import seaborn as sns; sns.set() 
from datetime import datetime
from dateutil.parser import parse
import pandas as pd



# 
start = datetime(2015, 1, 1)

end = datetime(2018, 3, 1)

#download Apple stock data
df = web.DataReader(['AAPL'], 'morningstar', start, end)



df=pd.DataFrame(df)

print(df.dtypes)


## select the Date and Symbol index and add as a main column

df["Date"]=df.index.get_level_values('Date')
df["Symbol"]=df.index.get_level_values('Symbol')

df.tail(3)

#drop columns
df2=df.drop(columns=['Date','Symbol'])

#Convert  index  to  column
df2=df2.reset_index()

#drop index
#df.drop(index='Date')

#We can use the drop parameter to avoid the old index being added as a column:
df3=df

df3.reset_index(drop=True)

print(df3.head(4))

df4 = pd.DataFrame([('bird',    389.0),
                    ('bird',     24.0),
                   ('mammal',   80.5),
                    ('mammal', np.nan)],
                  index=['falcon', 'parrot', 'lion', 'monkey'],
                  columns=('class', 'max_speed'))
df4.head()

#drop an index column
print(df4.reset_index(drop=True))

#df3.reset_index(level=['Date'])
#df3.MultiIndex.drop(labels, level=None, errors='raise')
df5=df2.drop(columns=['Symbol','Volume'])


#Set the index to become the 
df5=df5.set_index(['Date'])



fig, ax = plt.subplots(1, 1,figsize=(20,10))
plt.subplots(1, 0)
params = {'legend.fontsize': 'x-large',
          'figure.figsize': (15, 8),
         'axes.labelsize': 'x-large',
         'axes.titlesize':'x-large',
         'xtick.labelsize':'x-large',
         'ytick.labelsize':'x-large'}
plt.rcParams.update(params)
plt.title('Stock Prices ', fontsize=20)
plt.ylabel('Price', fontsize=20)
plt.xlabel('Date', fontsize=20)

df5.plot(lw=2,grid = True)
fig.savefig('Apple.jpg')
plt.grid(True)
plt.legend(loc='lower right')
plt.show()






```

We can also plot transfer the data from the Python environment and plot with ggplot as follows:
```{r}
#install.packages("viridis")
library(viridis)


df6=py$df3%>%mutate(Date=as.Date(Date))
ggplot(df6)+geom_line(aes(x=Date,y=Close,color="Close"))+geom_line(aes(x=Date,y=High,color="High"))+geom_line(aes(x=Date,y=Low,color="Low"))+geom_line(aes(x=Date,y=Open,color="Open"))+
scale_color_viridis(discrete=TRUE,option = "A")+
  #scale_fill_viridis(discrete = T,option = "C")+
      theme(
    legend.position="top",
    legend.direction="horizontal",
    legend.title = element_blank(),
    text=element_text(size=8,  family="Comic Sans MS"),
    axis.text.x=element_text(angle=45,hjust=1,size = 9),
    axis.text.y=element_text(size = 8),
    legend.text = element_text(size=8)
)+

  
  labs(y="Value",x="Date",title="")+
  
  # scale_x_date(date_labels = "%b %d")
 #scale_x_date(labels = date_format("%m-%y"))

 scale_x_date(breaks = date_breaks("4 month"),labels=date_format("%b %Y") ) 




df6%>% select(Date,High,Close,Low,Open,Symbol)%>%
gather(Name,Value,-Date,-Symbol)%>%mutate(Name=as.factor(Name))%>%
  
  ggplot(aes(x=Date,y=Value,color=Name))+geom_line()+
  
scale_color_viridis(discrete=TRUE,option = "D")+
  #scale_fill_viridis(discrete = T,option = "C")+
   theme(
   
    
    legend.title = element_blank(),
    text=element_text(size=8,  family="Comic Sans MS"),
    axis.text.x=element_text(angle=45,hjust=1,size = 9),
    axis.text.y=element_text(size = 8),
    legend.text = element_text(size=8)
)+
   scale_x_date(breaks = date_breaks("4 month"),labels=date_format("%b %Y") ) 


  # scale_fill_manual(values=c("#B9DE28FF" , "#D1E11CFF" , "#E8E419FF"))
```



The reticulate Package
---------------------------------

Another alternative to working with in R is via the reticulate package. The reticulate package has made it possible for several popular python libraries such as  tensorflow and keras available in R. It provides a set of tools for  interoperability between R and Python. It's functionality include sourcing python scripts,using Python interactively within an R session and importing modules.




```{r}

library(reticulate)
os <- import("os")

#get current working directory
os$getcwd()

#list files current directory
os$listdir(".")

```

#### Python in R Markdown

```{python}
from IPython import get_ipython
#get_ipython().magic('reset -sf')

import matplotlib.pyplot as plt
#%matplotlib inline 
import numpy as np


fig, ax = plt.subplots(1, 1,figsize=(20,10))
plt.subplots(1, 0)
t=np.arange(-5,5,0.01)
s1=1+np.sin(0.5*np.pi*t)
s2=1+np.cos(0.5*np.pi*t)
plt.plot(t,s1, label="sine", linestyle='--')
plt.plot(t,s2, label="cosine",    lw=2)
plt.grid(True)
plt.title('Sine and Cosine Functions ', fontsize=20)
plt.ylabel('y-axis', fontsize=20)
plt.xlabel('x-axis', fontsize=20)
plt.grid(True)
# Place a legend above this subplot, expanding itself to
# fully use the given bounding box.
#plt.legend(bbox_to_anchor=(0, 1.02, 1., .102), loc=3,
#          ncol=1, mode="expand", borderaxespad=0.)
# Place a legend to the right of this smaller subplot.
plt.legend(bbox_to_anchor=(-0.1, 1.11), loc=2, borderaxespad=0.5)
#plt.legend(loc='lower right')
plt.savefig('trig.jpg')
plt.show()


#print(s)

```




```{python}
import pandas


employeedata = pandas.read_csv("https://raw.githubusercontent.com/NanaAkwasiAbayieBoateng/Datasets/master/EmployeeAttrition.csv")
employeedata = employeedata[employeedata['BusinessTravel'] == "Travel_Frequently"]
employeedata = employeedata[['Age', 'Attrition', 'BusinessTravel','DailyRate','Department']]
employeedata = employeedata.dropna()

```


```{r}
library(ggplot2)
ggplot(py$employeedata, aes(Age,fill=Attrition)) + geom_histogram(bins = 30)
```



#### Sourcing Python scripts

A Python script can be sourced using source_python() function. For example, if you had the following Python script employeeAttrition.py:


```{r, fig.width=5, fig.height=4}
source_python("/Users/nanaakwasiabayieboateng/Documents/memphisclassesbooks/DataMiningscience/employeeAttrition.py")


employeedata <- read_employee("https://raw.githubusercontent.com/NanaAkwasiAbayieBoateng/Datasets/master/EmployeeAttrition.csv")

library(ggplot2)
ggplot(py$employeedata, aes(Age,fill=Attrition)) + geom_histogram(bins = 30)

```


#### Python REPL
The repl_python() function allows switching between Python and R a breeze.First a call is made to repl_python() function , which provides a Python REPL embedded within your R session.Objects created within the Python REPL can be accessed from R using the py object exported from reticulate. The Python and R code can together be run in the R console like the example below.


```{r ,eval=FALSE,  echo=T }

# repl_python()
# 
# import pandas
# 
# 
# employeedata = pandas.read_csv("https://raw.githubusercontent.com/NanaAkwasiAbayieBoateng/Datasets/master/EmployeeAttrition.csv")
# employeedata = employeedata[employeedata['BusinessTravel'] == "Travel_Frequently"]
# employeedata = employeedata[['Age', 'Attrition', 'BusinessTravel','DailyRate','Department']]
# employeedata = employeedata.dropna()
# exit
# 
# library(ggplot2)
# ggplot(py$employeedata, aes(Age,fill=Attrition)) + geom_histogram(bins = 30)

```




```{r pressure, echo=FALSE, fig.cap="Employee Age", out.width = '100%'}
knitr::include_graphics("/Users/nanaakwasiabayieboateng/Downloads/repl_python.png")
```
