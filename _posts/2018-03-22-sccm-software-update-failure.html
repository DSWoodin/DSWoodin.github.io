---
layout: post
title: 'SCCM Software update Failure :  CBS_E_STORE_CORRUPTION (KB3000850)'
date: '2018-03-22T06:06:00.000-07:00'
author: syswow64
tags:
- '0x800f0831'
- SCCM
- Store corruption
- '0x80240022'
- CBS
- CBS_E_STORE_CORRUPTION
- '0x80070002'
- KB3000850
modified_time: '2020-01-17T04:20:26.817-08:00'
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-4439978529742146522
blogger_orig_url: https://www.syswow64.co.uk/2018/03/sccm-software-update-failure.html
---

<b><span style="font-size: large;">Scenario:</span></b><br />A two node cluster required new and old software updates to bring it up to compliance. The installation of KB3000850 was failing to install either manually or via SCCM deployment on one node&nbsp; but not the other.<br /><br /><b>WUAHandler.log</b><br />Installation job encountered some failures. Error = 0x80240022. Commit Result = 0x00000001<br /><br /><b>CBS.log</b><br />&nbsp;Not able to add file to extract: update.ses [HRESULT = 0x80070002 - ERROR_FILE_NOT_FOUND]<br /><br />CBS&nbsp;&nbsp;&nbsp; Store corruption, manifest missing for package: Package_33_for_KB3081320~31bf3856ad364e35~amd64~~6.3.1.1<br />CBS&nbsp;&nbsp;&nbsp; Mark store corruption flag because of package: Package_33_for_KB3081320~31bf3856ad364e35~amd64~~6.3.1.1. [HRESULT = 0x800f0831 - CBS_E_STORE_CORRUPTION]<br /><br />&nbsp;Failed to resolve package [HRESULT = 0x800f0831 - CBS_E_STORE_CORRUPTION]<br /><br />WER: Generating failure report for package: Package_for_KB3000850~31bf3856ad364e35~amd64~~6.3.1.8, status: 0x800f0831, failure source: Execute, start state: Staged, target state: Installed, client id: WindowsUpdateAgent<br /><br /><br /><span style="font-size: large;">Common troubleshooting steps carried out without success:</span><br /><br />net stop wuauserv<br />net stop cryptsvc<br />Ren %systemroot%\SoftwareDistribution SoftwareDistribution.bak<br />Ren %systemroot%\system32\catroot2 catroot2.bak<br />net start wuauserv<br />net start cryptsvc<br /><br /><span style="background-color: white; font-weight: bold;">SFC /Scannow</span><br /><span style="background: white;">Dism /Online /Cleanup-Image /RestoreHealth /Source:wim:E:\sources\install.wim:1 /limitaccess</span><br /><span style="background: white;"><br /></span><br /> <span style="background: white; font-size: large; font-weight: bold;">Resolution:</span><br /><span style="background: white; font-weight: bold;"><br /></span><span style="background-color: white;"><b>Note the KB detailed within the CBS log after "</b></span>Store corruption, manifest missing for package:". In my case it was KB3081320. This KB was not installed on the failed node from within control panel or Powershell (get-hotfix | select hotfixid) however, the manifest file was present within the folder&nbsp;C:\Windows\servicing\Packages.<br /><br />Download the KB MSU file from the <a href="https://www.catalog.update.microsoft.com/Home.aspx" target="_blank">Microsoft Update catalog&nbsp;</a>&nbsp;and extract the CAB file to a temp directory.<br /><br /><span style="background-color: white;"><span style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: #333333; font-family: &quot;Segoe UI&quot;; font-size: 10.5pt;">expand C:\temp\updates\</span><span style="font-family: Calibri; font-size: 11.0pt;">windows8.1-kb3081320-x64_d6e34f82e20d9efa19ab0ae7a938f8d80c01416e.msu</span><span style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: #333333; font-family: &quot;Segoe UI&quot;; font-size: 10.5pt;"> /f:* C:\temp\updates\</span><span style="font-family: Calibri; font-size: 11.0pt;">kb3081320</span></span><br /><span style="background: white; font-weight: bold;"><br /></span><span style="background: white; font-weight: bold;">Then remove the package using DISM; this will in affect remove the manifest file from&nbsp;</span>C:\Windows\servicing\Packages<br /><span style="background: white; font-weight: bold;"><br /></span><span style="background: white; font-weight: bold;">dism /online /remove-package:C:\Temp\Updates\kb3081320\Windows8.1-KB3081320-x64.cab</span><br /><span style="background: white; font-weight: bold;"><br /></span><span style="background: white; font-weight: bold;">Finally after removing the corrupted manifest files /updates the intended update&nbsp;</span>KB3000850 will install via DISM/SCCM successfully and the CBS log will not have any corruption errors.<br /><br /><span style="background: white; color: #333333; font-family: &quot;Segoe UI&quot;; font-size: 10.5pt;">Dism /online /add-package /packagepath:</span><span style="font-family: Calibri; font-size: 11.0pt;">C:\Temp\Updates\kb3000850\Windows8.1-KB3000850-x64.cab</span><br /><span style="font-family: Calibri; font-size: 11.0pt;"><br /></span><br /><br />