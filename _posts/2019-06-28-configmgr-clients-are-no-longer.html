---
layout: post
title: ConfigMgr Clients are no longer receiving User Deployments
date: '2019-06-28T03:53:00.000-07:00'
author: syswow64
tags:
modified_time: '2020-01-17T04:20:26.534-08:00'
thumbnail: https://1.bp.blogspot.com/-G53mZB2Ycg0/XRXKgz5k_UI/AAAAAAAABe4/A5D4a6mLhigzm4iJJ4vrUimsVyMoeabeACLcBGAs/s72-c/AppCatalog_Roles.png
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-2741326118458160002
blogger_orig_url: https://www.syswow64.co.uk/2019/06/configmgr-clients-are-no-longer.html
---

<h2>Removing the Application Catalog Role within ConfigMgr was not as straight forward as i was hoping !</h2><div>Like many SCCM admins historically the Application Catalog Web service Point and Website point were installed in order to deploy applications to Users.&nbsp;&nbsp;</div><div>However, this feature is now depreciated and User deployments can be deployed without this role as the client will query a management point instead for all deployments (user and device).</div><div>(<a href="https://docs.microsoft.com/en-us/sccm/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures">https://docs.microsoft.com/en-us/sccm/core/plan-design/changes/deprecated/removed-and-deprecated-cmfeatures</a>)</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-G53mZB2Ycg0/XRXKgz5k_UI/AAAAAAAABe4/A5D4a6mLhigzm4iJJ4vrUimsVyMoeabeACLcBGAs/s1600/AppCatalog_Roles.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="397" data-original-width="587" height="216" src="https://1.bp.blogspot.com/-G53mZB2Ycg0/XRXKgz5k_UI/AAAAAAAABe4/A5D4a6mLhigzm4iJJ4vrUimsVyMoeabeACLcBGAs/s320/AppCatalog_Roles.png" width="320" /></a></div><div>I decided that this role should be removed as we were on 1810 Hotfix2 and colleagues had stated the transition was near seamless (see below regarding a reported BUG and quick fix to modify any Client setting).</div><div><br /></div><div>The procedure to remove the App Catalog role is straight forward:</div><div>1. Remove references to App Catalog website within Client Settings.</div><div>2. Remove the Roles within the SCCM console.</div><div>See <a href="https://www.asquaredozen.com/2018/11/02/removing-the-application-catalog-role-after-upgrading-to-configmgr-1806/" target="_blank">Adam Gross blog</a>&nbsp;</div><br />In our case the removal of the website within Client Settings and the system roles was straight forward however, we saw in a few cases <b><span style="font-size: large;">Clients are no longer receiving User Deployments </span></b>and I thought I would write this blog to share my experience and how to detect systems in a similar state.<br /><br />Lets gather the logs!<br /><br />SCClient_Domain@USERNAME_1.log<br /><blockquote class="tr_bq"><span style="font-size: x-small;">Using endpoint Url: https://AppCatalogSERVER:443/CMApplicationCatalog, Windows authentication <span style="white-space: pre;"> </span> (Microsoft.SoftwareCenter.Client.Data.ACDataSource+&lt;&gt;c at &lt;RefreshLocalSettingsAsync&gt;b__13_0)</span></blockquote>The client is looking for User deployments using the AppCatalog server website however, this does not exist and it not referenced in Client Settings.<br /><br />PolicyAgent.log<br /><br /><blockquote class="tr_bq">Raising event:<br />instance of CCM_PolicyAgent_PolicyDownloadSucceeded&nbsp;</blockquote><blockquote class="tr_bq">Failed to compile rule "{Rule_WRC10000}": 0x8000ffff</blockquote><blockquote class="tr_bq">Raising event:<br />instance of CCM_PolicyAgent_PolicyCompileFailed&nbsp;</blockquote>We can see that Policy is downloaded however fails to compile.<br /><br />The Image below details the "Actual" policy applied and as you can see 'Reserved1' details the AppCatalog Website which does not exist; however the client is told to use this address to find User deployments.&nbsp; As the site does not exist policy cannot exist and Software Center does not show User deployed Applications.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-RhBAieDutQg/XRXQaqABXwI/AAAAAAAABfE/VyELyCggRWMaE9hmjBWl16J0oFMdcl4TQCLcBGAs/s1600/PolicySpy_Actual.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1005" data-original-width="1290" height="497" src="https://1.bp.blogspot.com/-RhBAieDutQg/XRXQaqABXwI/AAAAAAAABfE/VyELyCggRWMaE9hmjBWl16J0oFMdcl4TQCLcBGAs/s640/PolicySpy_Actual.png" width="640" /></a></div>The Image below details the "Requested" policy applicable via Client Settings. As you can see 'Reserved1' does not detail the AppCatalog Website; the client should understand that and receive User policy from the Management Points as intended.&nbsp; If this was working the SCClient_Domain@USERNAME_1.log would show details for the Management Points instead.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-3GjdsE4mV7I/XRXRGpxyCeI/AAAAAAAABfM/m0TLdzH8FGYeiNlbA7b_AIrlToMgU7RUgCLcBGAs/s1600/PolicySpy_Requested.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1012" data-original-width="1150" height="562" src="https://1.bp.blogspot.com/-3GjdsE4mV7I/XRXRGpxyCeI/AAAAAAAABfM/m0TLdzH8FGYeiNlbA7b_AIrlToMgU7RUgCLcBGAs/s640/PolicySpy_Requested.png" width="640" /></a></div><br /><br />While I cannot explain why the Client Settings are not compiling it did conclusively show that the Site Server was offering the right policy but the client was not applying it.&nbsp; Various sites have stated this behavior is a known bug and that simply changing a Client Setting would re-engage the client and allow the desired policy to apply.<br /><br />This client would not update which made me wonder <span style="font-size: large;">how many systems in the estate have this exact issue?</span><br /><br /><br />Using PowerShell you can query the class CCM_ClientAgentConfig namespace and report a compliance metric; this is easily deployed via ConfigMgr Baselines..<br /><br /><blockquote class="tr_bq">$ClientConfig =Get-WmiObject -class CCM_ClientAgentConfig -namespace "root\ccm\policy\machine\actualconfig"<br />IF ($ClientConfig.Reserved1 -eq "https://AppCatalogSERVER:443/CMApplicationCatalog")<br />{Write-host "Non-Compliant"}<br />ELSE<br />{Write-host "Compliant"}</blockquote><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-jMrYMj04wFA/XRXv_akb2zI/AAAAAAAABfY/qiAJKKkiYpIw3wP8YYLgPe7We-EowhxywCLcBGAs/s1600/CCMClientAgentConfig_Baseline.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="683" data-original-width="1008" height="432" src="https://1.bp.blogspot.com/-jMrYMj04wFA/XRXv_akb2zI/AAAAAAAABfY/qiAJKKkiYpIw3wP8YYLgPe7We-EowhxywCLcBGAs/s640/CCMClientAgentConfig_Baseline.png" width="640" /></a></div><br /><br />The hope at this point is that the Agent Config client settings compile issue is limited to a small number of systems. Once the exposure of non-compliant system is understood we can see if a Remediation Script needs to be added to the Baseline.<br /><br />...........Watch this space for Remediation (28/06/19)<br /><br /><br /><br /><br />Key Search words, phrases<br /><br />CCM_PolicyAgent_PolicyCompileFailed<br />Policy not compiling<br />Remove AppCatalog<br /><br />