---
layout: post
title: Windows 10 - Feature Upgrade using SCCM Servicing (13/06/2019 Updated)
date: '2017-11-13T03:46:00.000-08:00'
author: syswow64
tags:
- Enterprise IT
- SCCM
- OOBE
- Windows 10
- Feature upgrade
- SetupConfig.ini
modified_time: '2020-01-17T04:20:27.006-08:00'
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-5092540255905934800
blogger_orig_url: https://www.syswow64.co.uk/2017/11/windows-10-feature-upgrade-using-sccm.html
---

Software Updates - Feature Upgrade - Windows 10<br /><br />Software updates within an Enterprise organisation has been fairly straight forward until you attempt to use it for Feature Upgrades of Windows 10.&nbsp; SCCM is very reliable at delivering the updates (Rollups, Updates, Upgrades) and as i have previously proved is UWF aware in Windows 10.<br />However, the Feature Upgrade does require a bit of prep work if you do not want the new Appx Applications installed as part of the Upgrade.<br /><br /><br />Moving between the 1507-1703 branches each Feature upgrade would reinstall the Appx Applications that you previously removed. Microsoft has addressed this in the 1703 - 1709 feature upgrade and if you removed an application it will not come back.&nbsp; However, if the new branch has a new application this will get installed.<br /><span style="font-family: &quot;verdana&quot; , sans-serif; font-size: xx-small;"><br /></span><span style="font-family: &quot;verdana&quot; , sans-serif; font-size: xx-small;">Uninstalled in-box apps no longer automatically reinstall</span><br /><span style="font-family: &quot;verdana&quot; , sans-serif; font-size: xx-small;">Starting with Windows 10, version 1703, in-box apps that were uninstalled by the user won't automatically reinstall as part of the feature update installation process.</span><br /><span style="font-family: &quot;verdana&quot; , sans-serif; font-size: xx-small;">Additionally, apps de-provisioned by admins on Windows 10, version 1703 machines will stay de-provisioned after future feature update installations. This will not apply to the update from Windows 10, version 1607 (or earlier) to version 1703.</span><br /><a href="https://docs.microsoft.com/en-gb/windows/whats-new/whats-new-windows-10-version-1703"><span style="font-family: &quot;verdana&quot; , sans-serif; font-size: xx-small;">https://docs.microsoft.com/en-gb/windows/whats-new/whats-new-windows-10-version-1703</span></a><br /><div><br /></div>&nbsp;By using the SetupConfig.ini file for an OOBE after the Feature upgrade, you will be able to ensure unwanted Appx applications are not provisioned&nbsp;and made available to the user; in addition to any other post action script you need to run.<br /><br /><b>Location of the SetupConfig.ini</b><br />Before the Feature Upgrade is deployed/installed via Software Center the SetupConfig.ini must be created and place locally on the system. Place the SetupConfig.ini file in the WSUS directory below; the WSUS folder does not exist by default. The Feature upgrade via SCCM will look in the WSUS folder and read the SetupConfig.ini<br /><br /><span style="background-color: white; color: #444444; font-family: monospace , serif;"><span style="font-size: x-small;">%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\<b><u>SetupConfig.ini</u></b></span></span><br /><br /><br /><b>Content of the SetupConfig.ini</b><br />In the ini file i have referenced the location of a file called "SetupComplete.cmd" that will be copied from this location to the hidden Feature Upgrade folder on the root of the C drive.&nbsp; c:\<b>$WINDOWS.~BT\Sources\Scripts\SetupComplete.cmd&nbsp;</b><br /><br />[SetupConfig]<br />Priority=High<br />PostOOBE=C:\ProgramData\OSConfig\setupcomplete.cmd<br /><b><br /></b><b><br /></b>Within the Setupact.log you will see the /PostOOBE switch detailed with the contents of the SetupConfig.ini file&nbsp;appended to the&nbsp;<i>Feature Upgrade Command Line&nbsp;</i>used to run the Software update.<br /><br /><i><b>SCCM Software Update / Feature Upgrade Command Line&nbsp;</b></i><br /><br />[/PreDownload /Update /Quiet&nbsp; /progressCLSID 71212340-ea4e-4e40-a0ee-a26312345baf /ReportId {A81239C5-8127-4352-1234-6CE01234531F}.200 "/ClientId" "fed1234-612d-40dd-123a-cd1234ee12d" "/CorrelationVector" "/oCGdL3nj012344.7.2"&nbsp; &nbsp;<b>/PostOOBE&nbsp;</b>C:\ProgramData\OSConfig\setupcomplete.cmd<b>]</b><br /><b><br /></b><b><br /></b><b><br /></b><b>Content of the SetupComplete.cmd</b><br />This command file calls several command lines for post Upgrade customization.<br /><br />powershell.exe -executionpolicy bypass -file C:\ProgramData\OSConfig\Start\Set-StartLayout.ps1<br />powershell.exe -executionpolicy bypass -file C:\ProgramData\OSConfig\Background\Set-Background.ps1<br />MsiExec.exe /X {F14000BE-0001-6400-0000-074957833700} /qn<br /><br /><br /><h2>Here is the cool bit.&nbsp;&nbsp;</h2><h4>The script below will create the SetupConfig.ini and SetupComplete.cmd files for you dynamically.&nbsp; I use this in an SCCM Baseline to create and ensure they are upto date with my modifications.</h4><br /><script src="https://gist.github.com/systemcenterblog/9c2737f000a2373a5815785d6e33337d.js"></script> In addition to the post custom scripts to set Background wallpapers and Start menu layouts I use the baseline to set 'Deprovisioned' regsitry keys so the Appx Applications are not provisioned for new users.<br /><br />Example PowerShell command to create key. See Microsoft for additional details&nbsp;<a href="https://docs.microsoft.com/en-us/windows/application-management/remove-provisioned-apps-during-update">https://docs.microsoft.com/en-us/windows/application-management/remove-provisioned-apps-during-update</a><br /><br />New-Item 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Deprovisioned\Microsoft.Messaging_8wekyb3d8bbwe' -Force<br /><br />I have scripted the process to create the keys using the PackageFamilyName. Remember do not Deprovision SystemApps otherwise you may experience issues with Applications you do want to use i.e. Photos.&nbsp; See Microsoft for the different categories&nbsp;<a href="https://docs.microsoft.com/en-us/windows/application-management/apps-in-windows-10">https://docs.microsoft.com/en-us/windows/application-management/apps-in-windows-10</a>&nbsp;.&nbsp;<a href="https://vacuumbreather.com/index.php/blog/itemlist/user/516-antonromanyuk" rel="author" style="-webkit-tap-highlight-color: rgba(241, 99, 75, 0.5); background-color: white; color: #f1634b; font-family: quicksandregular, Verdana, Helvetica, Arial, sans-serif; font-size: 12.6px; text-decoration-line: none; transition: color 0.2s ease-out 0s;">Anton Romanyuk</a>&nbsp;Makes reference to this his blog (Thanks).<br /><br /><br /><script src="https://gist.github.com/systemcenterblog/9f67ca8cf25dbbd8705c5eced326dcaa.js"></script> <br />Next Line <br /><br /><br />