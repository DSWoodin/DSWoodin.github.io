---
layout: post
title: How to sign a powershell script
date: '2012-10-16T04:43:00.000-07:00'
author: syswow64
tags:
- server 2008
- powershell
- windows 7
- scripts
modified_time: '2012-12-31T06:42:36.342-08:00'
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-1080732188645549189
blogger_orig_url: https://www.syswow64.co.uk/2012/10/how-to-sign-powershell-script.html
---

<h1>How to sign a powershell script</h1><br/><a href="http://blogs.technet.com/b/heyscriptingguy/archive/2010/06/16/hey-scripting-guy-how-can-i-sign-windows-powershell-scripts-with-an-enterprise-windows-pki-part-1-of-2.aspx" rel="nofollow">http://blogs.technet.com/b/heyscriptingguy/archive/2010/06/16/hey-scripting-guy-how-can-i-sign-windows-powershell-scripts-with-an-enterprise-windows-pki-part-1-of-2.aspx</a><br/><br/><a href="http://blogs.technet.com/b/heyscriptingguy/archive/2010/06/17/hey-scripting-guy-how-can-i-sign-windows-powershell-scripts-with-an-enterprise-windows-pki-part-2-of-2.aspx" rel="nofollow">http://blogs.technet.com/b/heyscriptingguy/archive/2010/06/17/hey-scripting-guy-how-can-i-sign-windows-powershell-scripts-with-an-enterprise-windows-pki-part-2-of-2.aspx</a><br/><br/>$cert=(dir cert:currentuser\my\ -CodeSigningCert)<br/><br/>Set-AuthenticodeSignature demoscript2.ps1 $cert -TimestampServer <a href="http://timestamp.comodoca.com/authenticode" rel="nofollow">http://timestamp.comodoca.com/authenticode</a><br/><br/><span style="color:#424242;">My PKI root is called </span><span style="color:#424242;"><b>pki.harper.labs</b></span><span style="color:#424242;">, and it is already trusted by my domain members, as shown in the following image.</span><br/><br/><img class="alignnone" title="hsg-6-16-10-01.jpg" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-01.jpg" height="193" width="445" /><br/><br/><span style="color:#424242;">I will follow these steps:</span><br/><ol><br/>	<li><span style="color:#424242;">Make the code signing certificate template available on my issuing certificate server.</span></li><br/>	<li><span style="color:#424242;">Request a code signing certificate for my user.</span></li><br/>	<li><span style="color:#424242;">Sign my Windows PowerShell script and run it.</span></li><br/>	<li><span style="color:#424242;">Deploy the code signing certificate as a trusted publisher through Active Directory.</span></li><br/></ol><br/><h4><span style="color:#424242;">Step 1: Make the code signing certificate template available on my issuing certificate server</span></h4><br/><span style="color:#424242;">Let’s start with making the code signing certificate available on the issuing certificate server so that our certificate server will issue code signing certificates. I do this at the issuing certificate server, and I start the Server Manager console and open the </span><span style="color:#424242;"><b>Active Directory Certificate Services</b></span><span style="color:#424242;"> node.</span><br/><br/><span style="color:#424242;">We will start with a look at the code signing certificate template. Find the template in the </span><span style="color:#424242;"><b>Certificate Templates</b></span><span style="color:#424242;"> node right under the </span><span style="color:#424242;"><b>Enterprise PKI</b></span><span style="color:#424242;"> node. This is called the </span><span style="color:#424242;"><b>Certificate Templates</b></span><span style="color:#424242;"> snap-in (and if you want you can open it up as a standalone snap-in in the Microsoft Management Console [mmc.exe]). This is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-02.jpg" height="180" width="539" /><br/><br/><span style="color:#424242;">I will not discuss how to create copies of the template here, so I will just use the existing certificate template. If you double-click the code signing template, you will get a property sheet with a few tabs, as shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-03.jpg" height="292" width="265" /><br/><br/><span style="color:#424242;">Because we are not creating a duplicate copy, we cannot change any of the values on the </span><span style="color:#424242;"><b>General</b></span><span style="color:#424242;"> tab. If we created a duplicate, we could change those. For example, how long should the certificate be valid? The same goes for </span><span style="color:#424242;"><b>Request Handling</b></span><span style="color:#424242;">, </span><span style="color:#424242;"><b>Subject Name</b></span><span style="color:#424242;">, and </span><span style="color:#424242;"><b>Extensions</b></span><span style="color:#424242;">. If we wanted to change those, we would have to create a duplicate.</span><br/><br/><span style="color:#424242;">What we will look at is the </span><span style="color:#424242;"><b>Security</b></span><span style="color:#424242;"> tab. We are interested in the permission to enroll---who should be able to enroll for a code signing certificate? I create a group in Active Directory called </span><span style="color:#424242;"><b>Codesigners</b></span><span style="color:#424242;">, and I grant the Read and Enroll permissions shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-04.jpg" height="298" width="267" /><br/><br/><span style="color:#424242;">Then I make members of this group the users who should be able to get a code signing certificate. I click </span><span style="color:#424242;"><b>OK</b></span><span style="color:#424242;">, and continue to the make the certificate template available on my issuing certificate server.</span><br/><br/><span style="color:#424242;">Next, I open the Certificate Authority console (the node is named </span><span style="color:#424242;"><b>pki.harper.labs</b></span><span style="color:#424242;"> in my environment, and is found under the </span><span style="color:#424242;"><b>Certificate Templates</b></span><span style="color:#424242;"> node in Server Manager, as shown in the next image). In the Certificate Authority console, you also see a </span><span style="color:#424242;"><b>Certificate Templates</b></span><span style="color:#424242;"> node. If you want to check if the code signing certificate template is available for enrollment, see if it is shown in the list. This is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-05.jpg" height="231" width="513" /><br/><br/><span style="color:#424242;">If the code signing template is not shown, we will add it. Right-click the </span><span style="color:#424242;"><b>Certificate Templates</b></span><span style="color:#424242;"> node, point to </span><span style="color:#424242;"><b>New</b></span><span style="color:#424242;">,</span><span style="color:#424242;"><em> </em></span><span style="color:#424242;">and then click </span><span style="color:#424242;"><b>Certificate Template to Issue</b></span><span style="color:#424242;">, as shown in the following image.</span><br/><br/><a href="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-06.jpg" rel="nofollow"><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-06.jpg" height="293" width="461" />g</a><br/><br/><span style="color:#424242;">From the list that appears, such as is shown in the following image, select the code signing template, and then click </span><span style="color:#424242;"><b>OK</b></span><span style="color:#424242;">. This list is read from Active Directory, and if you just created the template, you might have to wait until it is replicated to all domain controllers.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-07.jpg" height="203" width="330" /><br/><br/><span style="color:#424242;">We are now able to request a code signing certificate, and enroll the users we gave Enroll permission on the template.</span><br/><h4><span style="color:#424242;">Step 2: Request a code signing certificate for my user</span></h4><br/><span style="color:#424242;">This step is done from my client computer, as a user that is member of the </span><span style="color:#424242;"><b>Codesigning</b></span><span style="color:#424242;"> group. I open the certificates snap-in through the Microsoft Management Console (mmc.exe). Then I add the </span><span style="color:#424242;"><b>Certificates</b></span><span style="color:#424242;"> snap-in by clicking </span><span style="color:#424242;"><b>File</b></span><span style="color:#424242;">, and then clicking</span><span style="color:#424242;"><b> Add/Remove Snap-in.</b></span><span style="color:#424242;"><b><em> </em></b></span><span style="color:#424242;">This is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-08.jpg" height="238" width="226" /><br/><br/><span style="color:#424242;">Click </span><span style="color:#424242;"><b>Certificates</b></span><span style="color:#424242;"> in the left pane, as shown in the following image. Click </span><span style="color:#424242;"><b>Add</b></span><span style="color:#424242;">, and then click </span><span style="color:#424242;"><b>OK</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-09.jpg" height="218" width="309" /><br/><br/><span style="color:#424242;">You want the snap-in to manage your user account, so click </span><span style="color:#424242;"><b>My user account</b></span><span style="color:#424242;">. Now that you have loaded the snap-in, let’s request a code signing certificate. Right-click </span><span style="color:#424242;"><b>Personal</b></span><span style="color:#424242;">, point to </span><span style="color:#424242;"><b>All Tasks</b></span><span style="color:#424242;">, and then click </span><span style="color:#424242;"><b>Request New Certificate</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-11.jpg" height="219" width="427" /><br/><br/><span style="color:#424242;">Just click </span><span style="color:#424242;"><b>Next</b></span><span style="color:#424242;"> in the first dialog box. Because we are requesting a certificate from our enterprise PKI, in the next dialog box, select the </span><span style="color:#424242;"><b>Active Directory Enrollment Policy</b></span><span style="color:#424242;">, and then click </span><span style="color:#424242;"><b>Next</b></span><span style="color:#424242;">, as is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-13.jpg" height="179" width="244" /><br/><br/><span style="color:#424242;">Because we made the code signing template available in step 1, you should see the template for code signing available for enrollment. You only see the certificates you have permissions for in the list, so if the code signing template does not show up, have a closer look at the permissions. Click the </span><span style="color:#424242;"><b>Code Signing</b></span><span style="color:#424242;"> certificate. If you look at the details, you will see the validity period of the certificate (the default template is one year or 365 days, as the details say).</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-15.jpg" height="78" width="337" /><br/><br/><span style="color:#424242;">All the information that is needed to create the certificate is automatically configured, but if you want, you can change some of it if you click </span><span style="color:#424242;"><b>Properties</b></span><span style="color:#424242;">. For example, if you want to make the private key exportable so that you can export/import the private keys to other computers, you can configure this by clicking </span><span style="color:#424242;"><b>Properties</b></span><span style="color:#424242;">, and then clicking the </span><span style="color:#424242;"><b>Private Key</b></span><span style="color:#424242;"> tab, as shown in the following image. This is necessary if you want to use the same certificate on multiple computers.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-16.jpg" height="238" width="243" /><br/><br/><span style="color:#424242;">When you are ready, click </span><span style="color:#424242;"><b>Enroll</b></span><span style="color:#424242;">. Wait while the certificate is being generated and issued. Click </span><span style="color:#424242;"><b>Finish</b></span><span style="color:#424242;">. You have now created a certificate for code signing!</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0616/hsg-6-16-10-19.jpg" height="125" width="511" /><br/><br/><span style="color:#424242;">Just a quick reminder that your requirements for signed scripts are set using the </span><span style="color:#424242;"><b>Set-ExecutionPolicy</b></span><span style="color:#424242;"> cmdlet (or by Group Policy).</span><br/><div><br/><table><br/><tbody><br/><tr><br/><td><span style="color:#424242;"><b>Setting</b></span></td><br/><td><span style="color:#424242;"><b>Description</b></span></td><br/></tr><br/><tr><br/><td><span style="color:#424242;">Unrestricted</span></td><br/><td><span style="color:#424242;">No requirements; all scripts allowed</span></td><br/></tr><br/><tr><br/><td><span style="color:#424242;">RemoteSigned</span></td><br/><td><span style="color:#424242;">All local scripts allowed; only signed remote scripts</span></td><br/></tr><br/><tr><br/><td><span style="color:#424242;">AllSigned</span></td><br/><td><span style="color:#424242;">All scripts need to be signed</span></td><br/></tr><br/><tr><br/><td><span style="color:#424242;">Restricted</span></td><br/><td><span style="color:#424242;">No scripts allowed</span></td><br/></tr><br/></tbody><br/></table><br/></div><br/><span style="color:#424242;">For this demonstration, my </span><span style="color:#424242;"><b>executionpolicy</b></span><span style="color:#424242;"> is set to </span><span style="color:#424242;"><b>AllSigned</b></span><span style="color:#424242;">. If I just try to run my script, it will fail, as shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-01.jpg" height="68" width="650" /><br/><br/><span style="color:#424242;">We will use the cmdlet </span><span style="color:#424242;"><b>Set-AuthenticodeSignature</b></span><span style="color:#424242;"> to sign the script. I will start storing the code signing certificate in a variable named </span><span style="color:#424242;"><b>$cert</b></span><span style="color:#424242;">.</span><br/><br/><span style="color:#424242;">$cert=(dir cert:currentuser\my\ -CodeSigningCert)</span><br/><br/><span style="color:#424242;">Then I am ready to sign my script with the </span><span style="color:#424242;"><b>Set-AuthenticodeSignature</b></span><span style="color:#424242;"> cmdlet. This is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-02.jpg" height="126" width="652" /><br/><br/><span style="color:#424242;">As you see, the status is valid, so the signing was successfully done. Please note that I recommend that you supply the</span><span style="color:#424242;"><b>TimeStampServer</b></span><span style="color:#424242;"> parameter. This will make sure the script works even though the certificate that signed it is expired. It will tell the system that the code signing certificate was valid at the time of signing. (Okay, I can imagine there are some situations where this might not be correct, but I also guess it will be good enough for most of us.) If you do not use the</span><span style="color:#424242;"><b>TimeStampServer</b></span><span style="color:#424242;"> parameter, the script will stop to work when the certificate used for signing expires. There are multiple sources for timestamping out there. Use one that suits you.</span><br/><br/><span style="color:#424242;">Let us try to run the scripts again, and see what happens. The results are shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-03.jpg" height="72" width="611" /><br/><br/><span style="color:#424242;">We get a question if we want to run the script or not. The question says that this is a script from an untrusted publisher. In Step 4, I will show you how to make the publisher (code signing certificate) trusted for your domain.</span><br/><br/><span style="color:#424242;">As for this computer, you can now make this publisher trusted by choosing </span><span style="color:#424242;"><b>A</b></span><span style="color:#424242;"> for </span><span style="color:#424242;"><b>Always run</b></span><span style="color:#424242;">. If you choose </span><span style="color:#424242;"><b>V</b></span><span style="color:#424242;"> for </span><span style="color:#424242;"><b>Never run</b></span><span style="color:#424242;">, you will explicitly make this publisher untrusted, and scripts signed by this certificate will not run.</span><br/><br/><span style="color:#424242;">Let’s stop and see what exactly is happening here. If you make any choice persistent (such as </span><span style="color:#424242;"><b>Always run</b></span><span style="color:#424242;"> or </span><span style="color:#424242;"><b>Never run</b></span><span style="color:#424242;">), the code signing certificate is stored as a trusted or untrusted publisher on your computer. You can see this through the GUI if you open mmc.exe and load the Certificates snap-in, as shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-04.jpg" height="241" width="193" /><br/><br/><span style="color:#424242;">Or, you could also do this from Windows PowerShell:</span><br/><br/><span style="color:#424242;">dir cert:\CurrentUser\TrustedPublisher</span><br/><br/><span style="color:#424242;">dir cert:\CurrentUser\Disallowed</span><br/><br/><span style="color:#424242;">As you will see in Step 4, you can also control this setting through Group Policy. For now, you can just click </span><span style="color:#424242;"><b>Run Once</b></span><span style="color:#424242;">, and the script is allowed to execute. If you open the script, you will see that the signature is attached at the bottom.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-05.jpg" height="266" width="234" /><br/><br/><span style="color:#424242;">You can also use validate the signature using the </span><span style="color:#424242;"><b>Get-Authenticode</b></span><span style="color:#424242;"> cmdlet.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-06.jpg" height="307" width="516" /><br/><br/><span style="color:#424242;">In this step, I showed you how to sign a Windows PowerShell script, and also how to make it trusted or untrusted on your computer. In the next step, we will make the code signing certificate trusted in our domain using group policy.</span><br/><br/><span style="color:#424242;"><b>Step 4: Make the code signing certificate trusted in my domain</b></span><br/><br/><span style="color:#424242;">If you were to deploy this in your domain, you would probably use Group Policy to make sure the code signing certificate in use is a trusted publisher. To do this there a two steps:</span><br/><br/><span style="color:#424242;">1. Export the code signing certificate.</span><br/><br/><span style="color:#424242;">2. Create a policy and import the code signing certificate into trusted publishers.</span><br/><h5><span style="color:#424242;">Export the code signing certificate</span></h5><br/><span style="color:#424242;">Let’s start with exporting the code signing certificate from the client computer where we requested the certificate.</span><br/><br/><span style="color:#424242;">Start the Certificates snap-in as shown in Step 2 </span><a href="http://blogs.technet.com/b/heyscriptingguy/archive/2010/06/16/hey-scripting-guy-how-can-i-sign-windows-powershell-scripts-with-an-enterprise-windows-pki-part-1-of-2.aspx" rel="nofollow">yesterday</a><span style="color:#424242;">. Open the </span><span style="color:#424242;"><b>Personal</b></span><span style="color:#424242;"> node, and then </span><span style="color:#424242;"><b>Certificates</b></span><span style="color:#424242;">. In the content pane, you will now see your certificate. (The one with </span><span style="color:#424242;"><b>Intended Purpose</b></span><span style="color:#424242;"> set to </span><span style="color:#424242;"><b>Code Signing</b></span><span style="color:#424242;">). Right-click the certificate, click </span><span style="color:#424242;"><b>All Tasks</b></span><span style="color:#424242;">, and then click </span><span style="color:#424242;"><b>Export</b></span><span style="color:#424242;">. You can see this in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-07.jpg" height="168" width="605" /><br/><br/><span style="color:#424242;">Click </span><span style="color:#424242;"><b>Next</b></span><span style="color:#424242;"> in each of the three dialog boxes you see. Make sure that you save the certificate somewhere you can access it from the computer on which you are going to run Group Policy Management. There is no security risk making the public part of this certificate available, so you can store it wherever you want.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-11.jpg" height="223" width="244" /><br/><br/><span style="color:#424242;">This finishes the export part from the client. Now we need to open up the Group Policy Management Console. This is a part of the Server Administration tools and is usually found if you have installed RSAT (Remote Server Administration Tools) on your client or on your domain controller. For this demonstration, I will run this from one of my domain controllers.</span><br/><h5><span style="color:#424242;">Create a policy and import the code signing certificate into trusted publishers</span></h5><br/><span style="color:#424242;">When I open the Group Policy Management Console, I start by creating a new policy. I open my domain (</span><span style="color:#424242;"><b>harper.labs</b></span><span style="color:#424242;">), right-click it, and click </span><span style="color:#424242;"><b>Choose Create a GPO in this domain, and link it here</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-13.jpg" height="312" width="268" /><br/><br/><span style="color:#424242;">Make sure that you create this Group Policy object (GPO) where you want it in your own domain. For this demonstration, I create it at the domain level. I give the policy the name </span><span style="color:#424242;"><b>Certificates Policy</b></span><span style="color:#424242;">, and I click </span><span style="color:#424242;"><b>OK</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-14.jpg" height="111" width="241" /><br/><br/><span style="color:#424242;">Select the policy (</span><span style="color:#424242;"><b>Certificates Policy</b></span><span style="color:#424242;">) in the navigation pane, right-click it, and click </span><span style="color:#424242;"><b>Edit</b></span><span style="color:#424242;">, as shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-15.jpg" height="241" width="244" /><br/><br/><span style="color:#424242;">Wait for the Group Policy Editor to start, and then click </span><span style="color:#424242;"><b>Computer Configuration</b></span><span style="color:#424242;">, click</span><span style="color:#424242;"><b> Policies</b></span><span style="color:#424242;">, click</span><span style="color:#424242;"><b> Windows Settings</b></span><span style="color:#424242;">, and then click</span><span style="color:#424242;"><b> Public Key Policies</b></span><span style="color:#424242;">. You are now ready to start the import. Right-click </span><span style="color:#424242;"><b>Trusted Publishers</b></span><span style="color:#424242;">, and then click</span><span style="color:#424242;"><b>Import</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-16.jpg" height="383" width="394" /><br/><br/><span style="color:#424242;">In the dialog box that asks you for the certificate to import, select the certificate you exported earlier. Then click </span><span style="color:#424242;"><b>Next</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-17.jpg" height="220" width="244" /><br/><br/><span style="color:#424242;">As shown in the following image, make sure the certificate is placed in the Trusted Publishers store, and click </span><span style="color:#424242;"><b>Next</b></span><span style="color:#424242;">.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-18.jpg" height="220" width="244" /><br/><br/><span style="color:#424242;">Now finish the wizard by clicking </span><span style="color:#424242;"><b>Finish</b></span><span style="color:#424242;">. You have imported the certificate as a trusted publisher, which is shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-19.jpg" height="219" width="244" /><br/><br/><span style="color:#424242;">You can confirm this by looking inside the Trusted Publishers node in the Group Policy Editor as shown in the following image.</span><br/><br/><a href="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-20.jpg" rel="nofollow"><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-20.jpg" height="349" width="553" />g</a><br/><br/><span style="color:#424242;">So, the next time the policy is updated on computers in your domain, they will add this certificate as a trusted publisher. You can now run scripts signed by this certificate without being asked if the certificate is trusted or not. You can also do the same with untrusted certificates if you want.</span><br/><br/><span style="color:#424242;">I will test this from my client computer. I will first make sure that the certificate is not in my trusted publishers list. This should be done through the Certificates snap-in on my client.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-21.jpg" height="240" width="392" /><br/><br/><span style="color:#424242;">Then I run </span><span style="color:#424242;"><b>gpupdate /force</b></span><span style="color:#424242;"> from my Windows PowerShell window. The results are shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-22.jpg" height="127" width="386" /><br/><br/><span style="color:#424242;">When the update is finished successfully, I refresh the Trusted Publishers list in my Certificates snap-in. My certificate should now be listed as trusted, as shown in the following image.</span><br/><br/><img class="alignnone" alt="" src="http://img.microsoft.com/library/media/1033/technet/images/scriptcenter/qanda/hsg/2010/june/hey0617/hsg-6-17-10-23.jpg" height="197" width="430" /><br/><br/><span style="color:#424242;">Psh[Cookham8]&gt;Set-AuthenticodeSignature .\helloworld.ps1 -cert $cert</span><br/><br/><span style="color:#424242;">   Directory: C:\foo</span><br/><br/><span style="color:#424242;">SignerCertificate                         Status                                       Path                                        </span><br/><br/><span style="color:#424242;">---------------</span><span style="color:#424242;">--                         –</span><span style="color:#424242;">--</span><span style="color:#424242;">--                                       –</span><span style="color:#424242;">--                                        </span><br/><br/><span style="color:#424242;">                                         UnknownError                                 helloworld.ps1      </span><br/><br/><span style="color:#424242;">If I then use notepad to save the file as ansii, the results are what you want.</span><br/><br/><span style="color:#424242;">Psh[Cookham8]&gt;Set-AuthenticodeSignature .\helloworld.ps1 -cert $cert</span><br/><br/><span style="color:#424242;">   Directory: C:\foo</span><br/><br/><span style="color:#424242;">SignerCertificate                         Status                                       Path                                        </span><br/><br/><span style="color:#424242;">---------------</span><span style="color:#424242;">--                         –</span><span style="color:#424242;">--</span><span style="color:#424242;">--                                       –</span><span style="color:#424242;">--                                        </span><br/><br/><span style="color:#424242;">D42B4A6B4DBB8C697E5CA2CDD51A7F1F9325B632  Valid                                        helloworld.ps1     </span>