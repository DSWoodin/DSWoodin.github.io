---
layout: post
title: Azure Active Directory Dynamic Groups for AutoPilot and Group Tags
date: '2021-05-02T02:34:00.006-07:00'
author: syswow64
tags:
modified_time: '2021-05-04T01:01:57.184-07:00'
thumbnail: https://lh3.googleusercontent.com/-juUYQ4sd7LU/YI5tzGAH3yI/AAAAAAAABrs/YWZrNt3A5NI7ho4zcWrKoxPjPLTInuZKACLcBGAsYHQ/s72-w400-c-h206/image.png
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-4965519113425608934
blogger_orig_url: https://www.syswow64.co.uk/2021/05/azure-active-directory-dynamic-groups.html
---

<p>&nbsp;</p><div class="separator" style="clear: both; text-align: left;">Introduction:</div><div class="separator" style="clear: both; text-align: center;"><div class="separator" style="clear: both; text-align: left;">In Azure Active Directory (Azure AD), you can create dynamic membership rules to automatically update groups. To quote Microsoft "Dynamic group membership reduces the administrative overhead of adding and removing users".. Or devices. This blog is to detail the properties and syntax needed to create dynamic membership rules for AutoPilot devices and assign deployment and ESP profiles.&nbsp;</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-dynamic-membership">https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-dynamic-membership</a>&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><div>I wanted to create a group of all AutoPilot registered devices that has a specific Group tag 'PAW'. The intention being to assign a specific AutoPilot deployment profile/ESP and a set of configuration but only to defined computers and not all AutoPilot registered devices.&nbsp;</div><div>Group tags will be created for different departments so they receive specific policy, apps, config per department i.e. Finance, HR, IT services etc.<div><br /></div></div><div>Within my list of AutoPilot devices (see how to populate AutoPilot list) I clicked on a device and gave it the group tag 'PAW'.</div><div><br /></div><div><div class="separator" style="clear: both; text-align: center;"><a href="https://lh3.googleusercontent.com/-juUYQ4sd7LU/YI5tzGAH3yI/AAAAAAAABrs/YWZrNt3A5NI7ho4zcWrKoxPjPLTInuZKACLcBGAsYHQ/image.png" style="margin-left: 1em; margin-right: 1em;"><img alt="" data-original-height="843" data-original-width="1634" height="206" src="https://lh3.googleusercontent.com/-juUYQ4sd7LU/YI5tzGAH3yI/AAAAAAAABrs/YWZrNt3A5NI7ho4zcWrKoxPjPLTInuZKACLcBGAsYHQ/w400-h206/image.png" width="400" /></a></div><br />Within Graph Explorer this Group Tag name can be found within the 'PhsicalIds' properties and will form the basis of our dynamic query.</div><div><br /></div><div>https://graph.microsoft.com/beta/devices/deviceid_1234#######################</div><div><br /></div><div><div class="separator" style="clear: both; text-align: center;"><a href="https://lh3.googleusercontent.com/-sHwJh_cKN6E/YI5xdtuAr1I/AAAAAAAABr8/FNGz0RcoDuIaOaoubaUBasEttnBScF1DgCLcBGAsYHQ/image.png" style="margin-left: 1em; margin-right: 1em;"><img alt="" data-original-height="240" data-original-width="884" height="109" src="https://lh3.googleusercontent.com/-sHwJh_cKN6E/YI5xdtuAr1I/AAAAAAAABr8/FNGz0RcoDuIaOaoubaUBasEttnBScF1DgCLcBGAsYHQ/w400-h109/image.png" width="400" /></a></div><br /><br /></div><div><br /></div><div>Now I need to create a Azure AD Group that only includes AutoPilot registered devices with the PAW group tag.</div><div><br /></div><div>How to create an Azure AD Group?</div><div><br /></div><div>Within Azure/Endpoint Manager select groups &gt; New Group.</div><div>Enter a Group names</div><div>Ensure Dynamic Device is selected within the drop down</div><div>Select 'Add dynamic query' to input query syntax</div><div><br /></div><div><div class="separator" style="clear: both; text-align: center;"><a href="https://lh3.googleusercontent.com/-hmo0TKnNK8k/YI5vVpSczNI/AAAAAAAABr0/YzDv9bdOMxEpolOKLZ_raqQEz4cptdjiACLcBGAsYHQ/image.png" style="margin-left: 1em; margin-right: 1em;"><img alt="" data-original-height="835" data-original-width="878" height="381" src="https://lh3.googleusercontent.com/-hmo0TKnNK8k/YI5vVpSczNI/AAAAAAAABr0/YzDv9bdOMxEpolOKLZ_raqQEz4cptdjiACLcBGAsYHQ/w400-h381/image.png" width="400" /></a></div><br /><br /></div><div><br /></div><div><div><br /></div></div><div><div>The following query is well documented to populate a group with all AutoPilot registered devices.</div><div><br /></div><div>(device.devicePhysicalIDs -any _ -contains "[ZTDId]")</div></div><div><br /></div><div>By using the 'and' operator we are now adding an additional parameter that must be found within Azure AD to be listed in the group.</div><div><br /></div><div>As seen within Graph Explorer the OrderID propery now details 'PAW' which can be discovered with the following query.</div><div><br /></div><div><div>(device.devicePhysicalIDs -any _ -contains "[ZTDId]") and (device.devicePhysicalIds -any _ -eq "[OrderID]:PAW")</div><div><br /></div></div><div><div class="separator" style="clear: both; text-align: center;"><a href="https://lh3.googleusercontent.com/-R4-_awHHEQE/YJD_EIvf-pI/AAAAAAAABsc/hAuN2ZSIRzAC6EIpRvGZh41G29RW08B3gCLcBGAsYHQ/image.png" style="margin-left: 1em; margin-right: 1em;"><img alt="" data-original-height="623" data-original-width="1644" height="151" src="https://lh3.googleusercontent.com/-R4-_awHHEQE/YJD_EIvf-pI/AAAAAAAABsc/hAuN2ZSIRzAC6EIpRvGZh41G29RW08B3gCLcBGAsYHQ/w400-h151/image.png" width="400" /></a></div><br /><br /></div></div></div><p></p><div class="separator" style="clear: both; text-align: left;"><br /><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><br /><p></p>