---
layout: post
title: Windows 10 - UE-V Deployment Guide
date: '2017-11-17T07:53:00.000-08:00'
author: syswow64
tags:
- Guide
- SettingsTemplateCatalogPath
- Enterprise IT
- ADMX
- UEV
- Windows 10
- UEVAppMonitor.exe
- UE-V
modified_time: '2020-01-17T04:20:26.963-08:00'
thumbnail: https://3.bp.blogspot.com/-GDf-PyKxtu4/Wg8ETiLwcyI/AAAAAAAABVw/4Thx3zG9Rr4F67ePOywgP_4xqBZtxPtHQCEwYBhgL/s72-c/ProgramData1.png
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-2323923972435302611
blogger_orig_url: https://www.syswow64.co.uk/2017/11/windows-10-ue-v-deployment-guide.html
---

<h2>Windows 10 - UE-V Deployment Guide</h2><br />UE-V in Windows 10 is setup pretty quickly but the documentation for Group Policy and expected outcomes is all over the place.&nbsp; In order to help other IT Pro's navigate their UE-V implementation I have documented my configuration with observations.<br /><b><br /></b><b>Folder and Executable Reference Table</b><br />Templates folder&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&nbsp;C:\ProgramData\Microsoft\UEV\Templates<br />InboxTemplates folder&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= C:\ProgramData\Microsoft\UEV\InboxTemplates<br />Scripts Folder&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= C:\ProgramData\Microsoft\UEV\Scripts<br />SettingsStoragePath&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = Central UNC Share i.e \\ServerName\UEVData\%UserName%<br />SettingsTemplateCatalogPath = Central UNC Share i.e \\ServerName\UEVCatalogPath<br /><br />UEVAppMonitor.exe&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = Scheduled Task "Monitor Application Settings"<br />ApplySettingsTemplateCatalog.exe = Scheduled Task "Template Auto Update"<br />Microsoft.Uev.SyncController.exe&nbsp; &nbsp;= Scheduled Task "Sync Controller Application"<br /><br />The UEV Templates folder is located within ProgramData folder and contains various sub-folders&nbsp; containing scripts, Templates and compiled Templates (depending on the Windows 10 branch).<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-GDf-PyKxtu4/Wg8ETiLwcyI/AAAAAAAABVw/4Thx3zG9Rr4F67ePOywgP_4xqBZtxPtHQCEwYBhgL/s1600/ProgramData1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="183" data-original-width="967" height="75" src="https://3.bp.blogspot.com/-GDf-PyKxtu4/Wg8ETiLwcyI/AAAAAAAABVw/4Thx3zG9Rr4F67ePOywgP_4xqBZtxPtHQCEwYBhgL/s400/ProgramData1.png" width="400" /></a></div><br /><br />In 1607 there are two folders (InboxTemplates and Templates).&nbsp; The InboxTemplates contains the standard Templates used to capture user configurations such as Themes, desktop settings, and MS applications.&nbsp; The Template folder contains the Compiled settings files that<br />UEVAppMonitor.exe will monitor and Sync to the "SettingsStoragePath".<br /><br />These Standard Templates can be registered individually or all at the same time via PowerShell. In 1709 there is the additional folder called "Scripts" containing the script&nbsp;<i>RegisterInboxTemplates.ps1. See below for contents of script to register all Templates within the folder InboxTemplates.</i><br /><br /><i># Enumerate the Inbox UE-V Templates and register those templates</i><br /><i>$inboxTemplates= Get-ChildItem -Path $env:PROGRAMDATA\Microsoft\UEV\InboxTemplates -Filter *.xml</i><br /><i>for ($count = 0; $count -lt $inboxTemplates.Count; $count++) {</i><br /><i>&nbsp; &nbsp; Register-UevTemplate -Path $inboxTemplates[$count].FullName -ErrorAction SilentlyContinue</i><br /><i>}</i><br /><br /><div class="separator" style="clear: both; text-align: center;"></div>Within the latest Group Policy templates (<a href="https://www.microsoft.com/en-gb/download/details.aspx?id=56121" target="_blank">Administrative Templates (.admx) for Windows 10 Fall Creators Update (1709)</a> ) There is the option to Enable UE-V and Auto-Register InboxTemplates. This led me to believe the<b> Register-UEVTemplates</b> script was not necessary and Group Policy would automatically register these InboxTemplates.&nbsp; During testing this action was not occurring and I started to think there was a problem within my environment.&nbsp; <u>However, this options appears to be only available if you exclusively run domain controllers 2012/R2 and above</u>. See Documentation <a href="https://docs.microsoft.com/en-us/windows/configuration/ue-v/uev-deploy-required-features#enable-the-ue-v-service" target="_blank">here</a>.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><i>"Group Policy ADMX templates configure the synchronization settings for the UE-V service and enable the central management of common UE-V service configuration settings by using an existing Group Policy infrastructure.</i><br /><i>Supported operating systems for the domain controller that deploys the Group Policy Objects include:</i><br /><i>Windows Server 2012 and Windows Server 2012 R2"</i><br /><br />If your environment is like mine with Domain Controller Functional Level 2008, there are several ways in which you can register these Templates automatically. An SCCM Baseline can be used to check for the compiled file/s and if non-compliant be resolved by remediation, i.e.&nbsp;<i>Register-UevTemplate '\\SERVER\SHARE\UEV\Templates\*.xml'.</i><br /><br />Alternatively you can copy all the InboxTemplates <span style="font-size: x-small;">(C:\ProgramData\Microsoft\UEV\InboxTemplates)</span> over to the UNC Share "SettingsTemplateCatalogPath"; then within group policy you can specify the Template Catalog path and tick the box to "Replace the Default Microsoft Templates". This will copy all the InboxTemplates (and Custom Templates) over to the Computer and register within the "Templates" folder as originally intended.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-0INC4p9wUXk/Wg8Htok4sNI/AAAAAAAABWM/XdPQlIsN4U451Ng06yjyndKQBxap3HM0wCEwYBhgL/s1600/GPO1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="286" data-original-width="1122" height="101" src="https://2.bp.blogspot.com/-0INC4p9wUXk/Wg8Htok4sNI/AAAAAAAABWM/XdPQlIsN4U451Ng06yjyndKQBxap3HM0wCEwYBhgL/s400/GPO1.png" width="400" /></a></div><br /><i>Windows Components/Microsoft User Experience Virtualization\Settings template catalog path</i><br /><br />Once the UEV Service has started (Enable-UEV) the SettingsTemplateCatalogPath value will be evaluated every 30 minutes. New templates discovered are registered and compiled.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-2nC9YxQq3hs/Wg8ETvofSDI/AAAAAAAABWA/qPqyqU-4DFIlDnYGyIb9DKYA_m4JVUScQCEwYBhgL/s1600/TASK1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="268" data-original-width="739" height="116" src="https://4.bp.blogspot.com/-2nC9YxQq3hs/Wg8ETvofSDI/AAAAAAAABWA/qPqyqU-4DFIlDnYGyIb9DKYA_m4JVUScQCEwYBhgL/s320/TASK1.png" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-JsveeF1SZSk/Wg8ET9yBwvI/AAAAAAAABWA/V3gwArVWYgcgaU1VvstXhqYr6Pe-y_o8QCEwYBhgL/s1600/TASK2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="272" data-original-width="741" height="117" src="https://2.bp.blogspot.com/-JsveeF1SZSk/Wg8ET9yBwvI/AAAAAAAABWA/V3gwArVWYgcgaU1VvstXhqYr6Pe-y_o8QCEwYBhgL/s320/TASK2.png" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-r2wjV5M_eCs/Wg8EUFbFiwI/AAAAAAAABWA/1PPUPxb17F0nVgy9ChmJsLwMY6U_UsDJACEwYBhgL/s1600/TASK3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="266" data-original-width="746" height="114" src="https://4.bp.blogspot.com/-r2wjV5M_eCs/Wg8EUFbFiwI/AAAAAAAABWA/1PPUPxb17F0nVgy9ChmJsLwMY6U_UsDJACEwYBhgL/s320/TASK3.png" width="320" /></a></div><br /><br />Once the Template has been registered and compiled to the "Templates folder" will be read by the process UEVAppMonitor.exe and detect all defined configuration changes. These changes are then copied to the "SettingsStoragePath" as a central location.&nbsp; The copy occurs every time a users logs out of a computer or every 5 minutes by default.<br /><br />If the "SettingsStoragePath" is not defined in Group Policy or manually by PowerShell the UE-V agent will read your Active Directory Home Folder path and set as default. The value can be changed via PowerShell or defined specifically within Group Policy to another UNC share location i.e. \\ServerName\UEVData\%UserName%.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-VW3O6P5xQ4A/Wg8ESp5zGfI/AAAAAAAABWA/b_LDhFKLaAEUo3Pqk-gKMnk0duF3J2HfgCEwYBhgL/s1600/HomeFolder.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="515" data-original-width="424" height="320" src="https://4.bp.blogspot.com/-VW3O6P5xQ4A/Wg8ESp5zGfI/AAAAAAAABWA/b_LDhFKLaAEUo3Pqk-gKMnk0duF3J2HfgCEwYBhgL/s320/HomeFolder.png" width="263" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-28Zr6P-1xdE/Wg8ETZduVCI/AAAAAAAABWA/Q_YxtSZ2Lgw3E0cb87-Q6qQAKN2EGXAEwCEwYBhgL/s1600/HomeFolder2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="340" data-original-width="448" height="302" src="https://3.bp.blogspot.com/-28Zr6P-1xdE/Wg8ETZduVCI/AAAAAAAABWA/Q_YxtSZ2Lgw3E0cb87-Q6qQAKN2EGXAEwCEwYBhgL/s400/HomeFolder2.png" width="400" /></a></div><br /><h3>Troubleshooting</h3>We had an extra registry setting for UEV that could not be removed by the ADMX templates; this settings was possibly left over from a previous revision of ADMX and had to be removed via PowerShell. Technet procedure documented <a href="https://technet.microsoft.com/en-us/library/ee461060.aspx" target="_blank">here</a>.<br /><br /><span style="font-family: &quot;segoe ui&quot; , sans-serif; font-size: 10pt;">Remove-GPRegistryValue -Name "GPO Name" -key "HKLM\Software\Policies\Microsoft\Windows\UEV\Agent</span><br /><span style="font-family: &quot;segoe ui&quot; , sans-serif; font-size: 10pt;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-gMW3BCxWRZs/Wg8ESa48m_I/AAAAAAAABWE/rERi-dK5xzQakJKtbXHzkvdb4vKXhqbPQCEwYBhgL/s1600/GPO2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="180" data-original-width="757" height="95" src="https://2.bp.blogspot.com/-gMW3BCxWRZs/Wg8ESa48m_I/AAAAAAAABWE/rERi-dK5xzQakJKtbXHzkvdb4vKXhqbPQCEwYBhgL/s400/GPO2.png" width="400" /></a></div><br /><br /><b>Reference</b><br /><a href="https://docs.microsoft.com/en-us/microsoft-desktop-optimization-pack/uev-v2/managing-the-ue-v-2x-agent-and-packages-with-windows-powershell-and-wmi-both-uevv2" target="_blank">To configure the UE-V Agent by using Windows PowerShell</a><br /><br /><b>Scheduled Tasks&nbsp;</b><br />Runs daily and will sync the TemplateCatalog directoy specified.<br /><b>https://docs.microsoft.com/en-us/windows/configuration/ue-v/uev-changing-the-frequency-of-scheduled-tasks</b><br /><br /><br /><style><!--  /* Font Definitions */  @font-face  {font-family:"Cambria Math";  panose-1:2 4 5 3 5 4 6 3 2 4;} @font-face  {font-family:Calibri;  panose-1:2 15 5 2 2 2 4 3 2 4;} @font-face  {font-family:"Segoe UI";  panose-1:2 11 5 2 4 2 4 2 2 3;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal  {margin-top:0cm;  margin-right:0cm;  margin-bottom:8.0pt;  margin-left:0cm;  line-height:107%;  font-size:11.0pt;  font-family:"Calibri",sans-serif;} .MsoChpDefault  {font-family:"Calibri",sans-serif;} .MsoPapDefault  {margin-bottom:8.0pt;  line-height:107%;}  /* Page Definitions */  @page WordSection1  {size:612.0pt 792.0pt;  margin:72.0pt 72.0pt 72.0pt 72.0pt;} div.WordSection1  {page:WordSection1;} --></style>