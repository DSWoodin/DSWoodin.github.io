---
layout: post
title: SCCM SUP WSUS Pool keeps stopping or the server is unresponsive
date: '2017-08-03T00:41:00.000-07:00'
author: syswow64
tags:
- SUP
- STOPS
- Job error (0x80240438) received for assignment
- can failed with error = 0x8024401c
- error = 0x80070032
- Pool
- wsus
- Job error (0x80240440) received for assignment
- sccm
modified_time: '2017-08-03T00:42:52.841-07:00'
blogger_id: tag:blogger.com,1999:blog-4452544758446808584.post-1610438019448456044
blogger_orig_url: https://www.syswow64.co.uk/2017/08/sccm-sup-wsus-pool-keeps-stopping-or.html
---

<h2>SCCM SUP WSUS Pool keeps stopping or the server is unresponsive</h2><b>Scenario:</b> Our WSUS/SUP had become unresponsive and the decision to reinstall the server role was made. After the Site server had been reinstalled &nbsp;I became aware that Windows Defender updates were failing to update (3 days old) and even though the updates were sync'd, downloaded, and deployed in SCCM the client was still unable to receive them.<br /><br /><br /><b>Client Log analysis</b>:<br /><br /><u>ScanAgent.log</u><br /><u><br /></u><span style="font-size: x-small;">ScanJob({999C9FFA-A463-4BE8-8771-67EE96D4140B}): CScanJob::OnScanComplete -Scan Failed with Error=0x80240440</span><br /><span style="font-size: x-small;">ScanJob({999C9FFA-A463-4BE8-8771-67EE96D4140B}): CScanJobManager::OnScanComplete- failed at CScanJob::OnScanComplete with error=0x80240440</span><br /><span style="font-size: x-small;"><br /></span><span style="font-size: x-small;"><br /></span><br /><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><u>Update Deployment.log</u></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Job error (0x80240440) received for assignment ({bf7a48e6-d220-4070-bb9b-ecc239107584}) action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdatesDeploymentAgent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><span style="font-size: 11pt;">Updates will not be made available &nbsp; &nbsp; &nbsp;&nbsp;</span></div><br /><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><u>WUAHandler.log</u></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Async searching of updates using WUAgent started. &nbsp; &nbsp; &nbsp;&nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Async searching completed. &nbsp; &nbsp; &nbsp;&nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">OnSearchComplete - Failed to end search job. Error = 0x8024401c. &nbsp; &nbsp; &nbsp; &nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Scan failed with error = 0x8024401c. &nbsp; &nbsp; &nbsp; &nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Its a WSUS Update Source type ({3AAB6A76-CE2D-4E8A-9F11-741AE69677A2}), adding it. &nbsp; &nbsp; &nbsp; &nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">OS Version is 6.3.9600 &nbsp;&nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Existing WUA Managed server was already set (http://CMSUP.domain.co.uk:8530<span style="font-size: 11pt;">), skipping Group Policy registration. &nbsp; &nbsp; &nbsp; &nbsp;</span></div><br /><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Added Update Source ({3AAB6A76-CE2D-4E8A-9F11-741AE69677A2}) of content type: 2 &nbsp; &nbsp; &nbsp; &nbsp;</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><u>WindowsUpdate.log</u></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Report WARNING: CSerializationHelper:: InitSerialize failed : 0x80070002</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><span style="font-size: 11pt;">AU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: Failed to get Wu Exemption info from NLM, assuming not exempt, error = 0x80070032</span></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><span style="font-size: 11pt;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: Nws Failure: errorCode=0x803d0006</span></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: Original error code: 0x80072ee2</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: There was an error communicating with the endpoint at '<span style="font-size: 14.6667px;">http://CMSUP.domain.co.uk:8530</span>/ClientWebService/client.asmx'.</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: There was an error receiving the HTTP reply.</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: The operation did not complete within the time allotted.</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">WS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WARNING: The operation timed out</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><b>Analysis Results:</b></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Since I removed the role and put it back it was like the role had been installed for the first time. &nbsp;Every client within SCCM (9k+) would need to do a <b>Full Software Update &amp; scan cycle</b>. This would generate a heavy load on the ISS pool on the SUP server. &nbsp;It is very important to configure the pool correctly otherwise the server will stop responding to clients as the client will receive <b>"Service Unavailable"</b> responses similar to DOS.</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><b>WSUS Pool Config</b></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Queue Length: 25000</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Limit (Percent) 70</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Limit Action Throttle</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Maximum workers (0 Numa) (1 Default) (2 if you have the server resource, not NUMA)</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">"Service Unavailable" Response TcpLevel</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Failure Interval (Minutes) 30</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Maximum Failures 60</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Private Memory Limit (KB) 0</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><b><br /></b></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><b><br /></b></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><b>Conclusion</b></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">&nbsp;Once we had the SUP role reinstalled synchronizing with SCCM (see WCM.log, Wsyncmgr.log) as well as the correct WSUS pool settings, we notice the server was still spiking CPU with ISS workers taking the full 70% limit without breaks.</div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">Upon reviewing the Client Policy (within SCCM Client Settings) for the estate the <b>"Software Update Scan schedule"</b> was set to 1 day (<span style="font-size: 14.6667px;">not the recommended 7 days)</span><span style="font-size: 11pt;">. This had the affect of overloading the WSUS server with 503 errors in the IIS log "service unavailable". As the schedule was every day the server could not get through the backlog before the whole process began again.</span></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;">After setting the scan schedule to 7 days, and as clients were checking for policy every hour we notice a steady decline in CPU activity within the hour and all clients were able to complete there scan&nbsp;<b style="font-size: 14.6667px;">Software Update &amp; scan cycle </b><span style="font-size: 14.6667px;">&nbsp;and all clients were able to download Software updates.</span></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div><div style="font-family: Calibri; font-size: 11.0pt; margin: 0in;"><br /></div>